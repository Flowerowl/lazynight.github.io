---
title: '操作摄像头(C#)'
author: Flowerowl
layout: post
permalink: /1537.html
duoshuo_thread_id:
  - 1266977
views:
  - 1191
bot_views:
  - 3
categories:
  - 'C#'
  - 代码
tags:
  - API
---
<p style="text-align: center;">
  今天带来了一个icon转换,现在拿出来一个操作摄像头的源码,学习下吧.
</p>

&nbsp;

[<img class="aligncenter size-full wp-image-1539" title="zz" src="http://lazynight.me/wp-content/uploads/2012/03/zz.jpg" alt="" width="650" height="480" />][1]  
哎,后边那东北的娃儿在看赵本山.<

<div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #fdfdfd; color: black; text-align: center; background-position: initial initial; background-repeat: initial initial;">
</div>

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;">
  <span style="color: #e3ceab;">using</span> <span style="color: #dcdccc;">System</span>;<br /> <span style="color: #e3ceab;">using</span> <span style="color: #dcdccc;">System.Collections.Generic</span>;<br /> <span style="color: #e3ceab;">using</span> <span style="color: #dcdccc;">System.Text</span>;<br /> <span style="color: #e3ceab;">using</span> <span style="color: #dcdccc;">System.Runtime.InteropServices</span>;<span style="color: #e3ceab;">namespace</span> <span style="color: #dcdccc;">Scene</span><br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #e3ceab;">public</span> <span style="color: #e3ceab;">class</span> <span style="color: #dcdccc;">VideoWork</span><br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">//窗体风格</span><br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_USER</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">x400</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WS_CHILD</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">x40000000</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WS_VISIBLE</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">x10000000</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_USER</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_STOP</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">68</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_DRIVER_CONNECT</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">10</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_DRIVER_DISCONNECT</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">11</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SAVEDIB</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">25</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_GRAB_FRAME</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">60</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SEQUENCE</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">62</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_FILE_SET_CAPTURE_FILEA</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">20</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SEQUENCE_NOFILE</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">63</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_OVERLAY</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">51</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_PREVIEW</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">50</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_VIDEOSTREAM</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">6</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_ERROR</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">2</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_STATUSA</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">3</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_FRAME</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">5</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_SCALE</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">53</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">const</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">WM_CAP_SET_PREVIEWRATE</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">WM_CAP_START</span> <span style="color: #dcdccc;">+</span> <span style="color: #8cd0d3;">52</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">hWndC</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dfdfbf; font-weight: bold;">bool</span> <span style="color: #dcdccc;">bWorkStart</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">false</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">mControlPtr</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">mWidth</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">mHeight</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">mLeft</span>;<br /> <span style="color: #e3ceab;">private</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">mTop</span>;<span style="color: #7f9f7f;">/**/</span><br /> <span style="color: #7f9f7f;">/// <summary></span><br /> <span style="color: #7f9f7f;">/// 初始化显示图像</span><br /> <span style="color: #7f9f7f;">/// </summary></span><br /> <span style="color: #7f9f7f;">/// <param name=&#8221;handle控件的句柄</param></span><br /> <span style="color: #7f9f7f;">/// <param name=&#8221;left&#8221;>开始显示的左边距</param></span><br /> <span style="color: #7f9f7f;">/// <param name=&#8221;top&#8221;>开始显示的上边距</param></span><br /> <span style="color: #7f9f7f;">/// <param name=&#8221;width&#8221;>要显示的宽度</param></span><br /> <span style="color: #7f9f7f;">/// <param name=&#8221;height&#8221;>要显示的长度</param></span><br /> <span style="color: #e3ceab;">public</span> <span style="color: #efef8f;">VideoWork</span>(<span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">handle</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">left</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">top</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">width</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">height</span>)<br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #dcdccc;">mControlPtr</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">handle</span>;<br /> <span style="color: #dcdccc;">mWidth</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">width</span>;<br /> <span style="color: #dcdccc;">mHeight</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">height</span>;<br /> <span style="color: #dcdccc;">mLeft</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">left</span>;<br /> <span style="color: #dcdccc;">mTop</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">top</span>;<br /> <span style="color: #dcdccc;">}</span><span style="color: #efef8f;">        [DllImport("avicap32.dll")]</span><br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">static</span> <span style="color: #e3ceab;">extern</span> <span style="color: #dcdccc;">IntPtr</span> <span style="color: #efef8f;">capCreateCaptureWindowA</span>(<span style="color: #dfdfbf; font-weight: bold;">byte</span><span style="color: #dcdccc;">[]</span> <span style="color: #dcdccc;">lpszWindowName</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">dwStyle</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">x</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">y</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">nWidth</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">nHeight</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">hWndParent</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">nID</span>);<span style="color: #efef8f;">        [DllImport("avicap32.dll")]</span><br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">static</span> <span style="color: #e3ceab;">extern</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #efef8f;">capGetVideoFormat</span>(<span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">hWnd</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">psVideoFormat</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">wSize</span>);</p> <p>
    <span style="color: #7f9f7f;">//</span><br /> <span style="color: #7f9f7f;">//这里特别注意，因为WinAPI中的long为32位，而C#中的long为64wei，所以需要将lParam该为int</span><br /> <span style="color: #7f9f7f;">//</span><br /> <span style="color: #efef8f;">        [DllImport("User32.dll")]</span><br /> <span style="color: #e3ceab;">private</span> <span style="color: #e3ceab;">static</span> <span style="color: #e3ceab;">extern</span> <span style="color: #dfdfbf; font-weight: bold;">bool</span> <span style="color: #efef8f;">SendMessage</span>(<span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">hWnd</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">wMsg</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">wParam</span><span style="color: #dcdccc;">,</span> <span style="color: #dfdfbf; font-weight: bold;">int</span> <span style="color: #dcdccc;">lParam</span>);
  </p>
  
  <p>
    <span style="color: #7f9f7f;">/**/</span><br /> <span style="color: #7f9f7f;">/// <summary></span><br /> <span style="color: #7f9f7f;">/// 开始显示图像</span><br /> <span style="color: #7f9f7f;">/// </summary></span><br /> <span style="color: #e3ceab;">public</span> <span style="color: #e3ceab;">void</span> <span style="color: #efef8f;">Start</span>()<br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #e3ceab;">if</span> (<span style="color: #dcdccc;">bWorkStart</span>)<br /> <span style="color: #e3ceab;">return</span>;
  </p>
  
  <p>
    <span style="color: #dcdccc;">bWorkStart</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">true</span>;<br /> <span style="color: #dfdfbf; font-weight: bold;">byte</span><span style="color: #dcdccc;">[]</span> <span style="color: #dcdccc;">lpszName</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">new</span> <span style="color: #dfdfbf; font-weight: bold;">byte</span><span style="color: #dcdccc;">[</span><span style="color: #8cd0d3;">100</span><span style="color: #dcdccc;">];</span>
  </p>
  
  <p>
    <span style="color: #dcdccc;">hWndC</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">capCreateCaptureWindowA</span>(<span style="color: #dcdccc;">lpszName</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WS_CHILD</span> | <span style="color: #dcdccc;">WS_VISIBLE</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">mLeft</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">mTop</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">mWidth</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">mHeight</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">mControlPtr</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);
  </p>
  
  <p>
    <span style="color: #e3ceab;">if</span> (<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ToInt32</span>() <span style="color: #dcdccc;">!=</span> <span style="color: #8cd0d3;"></span>)<br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_VIDEOSTREAM</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_ERROR</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_CALLBACK_STATUSA</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_DRIVER_CONNECT</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_SCALE</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">1</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_PREVIEWRATE</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">66</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_OVERLAY</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">1</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SET_PREVIEW</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">1</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #7f9f7f;">//Global.log.Write(&#8220;SendMessage&#8221;);</span><br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #e3ceab;">return</span>;
  </p>
  
  <p>
    <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">/**/</span><br /> <span style="color: #7f9f7f;">/// <summary></span><br /> <span style="color: #7f9f7f;">/// 停止显示</span><br /> <span style="color: #7f9f7f;">/// </summary></span><br /> <span style="color: #e3ceab;">public</span> <span style="color: #e3ceab;">void</span> <span style="color: #efef8f;">Stop</span>()<br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_DRIVER_DISCONNECT</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span>);<br /> <span style="color: #dcdccc;">bWorkStart</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">false</span>;<br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">/**/</span><br /> <span style="color: #7f9f7f;">/// <summary></span><br /> <span style="color: #7f9f7f;">/// 抓图</span><br /> <span style="color: #7f9f7f;">/// </summary></span><br /> <span style="color: #7f9f7f;">/// <param name=&#8221;path&#8221;>要保存bmp文件的路径</param></span><br /> <span style="color: #e3ceab;">public</span> <span style="color: #e3ceab;">void</span> <span style="color: #efef8f;">GrabImage</span>(<span style="color: #dfdfbf; font-weight: bold;">string</span> <span style="color: #dcdccc;">path</span>)<br /> <span style="color: #dcdccc;">{</span><br /> <span style="color: #dcdccc;">IntPtr</span> <span style="color: #dcdccc;">hBmp</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">Marshal</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">StringToHGlobalAnsi</span>(<span style="color: #dcdccc;">path</span>);<br /> <span style="color: #dcdccc;">SendMessage</span>(<span style="color: #dcdccc;">hWndC</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">WM_CAP_SAVEDIB</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;"></span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">hBmp</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ToInt32</span>());<br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #dcdccc;">}</span>
  </p>
</div>

<span style="color: #ff6600;"><a href="http://dl.dbank.com/c0tl99n8qv" target="_blank"><span style="color: #ff6600;">下载源码</span></a></span>

转载请注明：[于哲的博客][2] &raquo; [操作摄像头(C#)][3]

 [1]: http://lazynight.me/wp-content/uploads/2012/03/zz.jpg
 [2]: http://localhost/wordpress
 [3]: http://localhost/wordpress/1537.html