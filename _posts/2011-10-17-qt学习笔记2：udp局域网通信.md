---
title: Qt学习笔记(2)：Udp局域网通信
author: Flowerowl
layout: post
permalink: /542.html
duoshuo_thread_id:
  - 1266858
views:
  - 1396
bot_views:
  - 3
categories:
  - 代码
tags:
  - Qt
---
<embed src="http://www.xiami.com/widget/0_1769019175/singlePlayer.swf" type="application/x-shockwave-flash" width="257" height="33" wmode="transparent">
</embed>

  
&nbsp;

和朋友准备做一个手机控制灯光的开关这么一个小东西。

用到Qt写N8的程序，现处于初级阶段，以此文留念。

<img class="aligncenter size-full wp-image-543" title="Lazynight | 夜阑" src="http://lazynight.me/wp-content/uploads/2011/10/12.jpg" alt="" width="720" height="640" />

<span style="color: #ff6600;">Sender：</span>

.cpp

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #c0c0c0; background-color: #000000;">
  <span style="color: #696969;">01</span> <span style="color: #ffffff;">#include &#8220;widget.h&#8221;</span><br /> <span style="color: #696969;">02</span> <span style="color: #ffffff;">#include &#8220;ui_widget.h&#8221;</span><br /> <span style="color: #696969;">03</span><br /> <span style="color: #696969;">04</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">Widget</span>(<span style="color: #c0c0c0;">QWidget</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">parent</span>) <span style="color: #c0c0c0;">:</span><br /> <span style="color: #f810b0;">05</span>     <span style="color: #c0c0c0;">QWidget</span>(<span style="color: #c0c0c0;">parent</span><span style="color: #c0c0c0;">),</span><br /> <span style="color: #696969;">06</span>     <span style="color: #c0c0c0;">ui</span>(<span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">Ui</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">Widget</span>)<br /> <span style="color: #696969;">07</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">08</span>     <span style="color: #c0c0c0;">ui</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">setupUi</span>(<span style="color: #ff4400; font-weight: bold;">this</span>);<br /> <span style="color: #696969;">09</span>     <span style="color: #c0c0c0;">sender</span><span style="color: #c0c0c0;">=</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">QUdpSocket</span>(<span style="color: #ff4400; font-weight: bold;">this</span>);<br /> <span style="color: #f810b0;">10</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">11</span><br /> <span style="color: #696969;">12</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::~</span><span style="color: #c0c0c0;">Widget</span>()<br /> <span style="color: #696969;">13</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">14</span>     <span style="color: #ff4400; font-weight: bold;">delete</span> <span style="color: #c0c0c0;">ui</span>;<br /> <span style="color: #f810b0;">15</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">16</span> <span style="color: #ffffff;">void</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">on_pushButton_clicked</span>()<br /> <span style="color: #696969;">17</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">18</span>     <span style="color: #c0c0c0;">QByteArray</span> <span style="color: #c0c0c0;">datagram</span> <span style="color: #c0c0c0;">=</span><span style="color: #d13800;">&#8220;ON!&#8221;</span>;<br /> <span style="color: #696969;">19</span>     <span style="color: #c0c0c0;">sender</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">writeDatagram</span>(<span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">data</span><span style="color: #c0c0c0;">(),</span><span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">size</span><span style="color: #c0c0c0;">(),</span><span style="color: #c0c0c0;">QHostAddress</span>(<span style="color: #c0c0c0;">ui</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">lineEdit</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">text</span><span style="color: #c0c0c0;">()),</span><span style="color: #c0c0c0;">45454</span>);<br /> <span style="color: #f810b0;">20</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">21</span> <span style="color: #ffffff;">void</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">on_pushButton_2_clicked</span>()<br /> <span style="color: #696969;">22</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">23</span>     <span style="color: #c0c0c0;">QByteArray</span> <span style="color: #c0c0c0;">datagram</span> <span style="color: #c0c0c0;">=</span><span style="color: #d13800;">&#8220;OFF!&#8221;</span>;<br /> <span style="color: #696969;">24</span>     <span style="color: #c0c0c0;">sender</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">writeDatagram</span>(<span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">data</span><span style="color: #c0c0c0;">(),</span><span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">size</span><span style="color: #c0c0c0;">(),</span><span style="color: #c0c0c0;">QHostAddress</span>(<span style="color: #c0c0c0;">ui</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">lineEdit</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">text</span><span style="color: #c0c0c0;">()),</span><span style="color: #c0c0c0;">45454</span>);<br /> <span style="color: #f810b0;">25</span> <span style="color: #c0c0c0;">}</span>
</div>

.h

&nbsp;

<div style="background: #fdfdfd; color: black;">
  <span style="text-decoration: underline;">C++语言</span>: <a href="http://fayaa.com/code/view/23278/">Codee#23278</a>
</div>

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #c0c0c0; background-color: #000000;">
  <span style="color: #696969;">01</span> <span style="color: #ffffff;">#ifndef WIDGET_H</span><br /> <span style="color: #696969;">02</span> <span style="color: #ffffff;">#define WIDGET_H</span><br /> <span style="color: #696969;">03</span><br /> <span style="color: #696969;">04</span> <span style="color: #ffffff;">#include <QWidget></span><br /> <span style="color: #f810b0;">05</span> <span style="color: #ffffff;">#include <QtNetwork></span><br /> <span style="color: #696969;">06</span> <span style="color: #ff4400; font-weight: bold;">namespace</span> <span style="color: #c0c0c0;">Ui</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">07</span>     <span style="color: #ff4400; font-weight: bold;">class</span> <span style="color: #c0c0c0;">Widget</span>;<br /> <span style="color: #696969;">08</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">09</span><br /> <span style="color: #f810b0;">10</span> <span style="color: #ff4400; font-weight: bold;">class</span> <span style="color: #c0c0c0;">Widget</span> <span style="color: #c0c0c0;">:</span> <span style="color: #ff4400; font-weight: bold;">public</span> <span style="color: #c0c0c0;">QWidget</span><br /> <span style="color: #696969;">11</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">12</span>     <span style="color: #c0c0c0;">Q_OBJECT</span><br /> <span style="color: #696969;">13</span><br /> <span style="color: #696969;">14</span> <span style="color: #ff4400; font-weight: bold;">public</span><span style="color: #c0c0c0;">:</span><br /> <span style="color: #f810b0;">15</span>     <span style="color: #ff4400; font-weight: bold;">explicit</span> <span style="color: #c0c0c0;">Widget</span>(<span style="color: #c0c0c0;">QWidget</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">parent</span> <span style="color: #c0c0c0;">=</span> <span style="color: #c0c0c0;"></span>);<br /> <span style="color: #696969;">16</span>     <span style="color: #c0c0c0;">~</span><span style="color: #c0c0c0;">Widget</span>();<br /> <span style="color: #696969;">17</span> <span style="color: #ff4400; font-weight: bold;">private</span> <span style="color: #c0c0c0;">slots:</span><br /> <span style="color: #696969;">18</span>     <span style="color: #ffffff;">void</span> <span style="color: #c0c0c0;">on_pushButton_clicked</span>();<br /> <span style="color: #696969;">19</span>     <span style="color: #ffffff;">void</span> <span style="color: #c0c0c0;">on_pushButton_2_clicked</span>();<br /> <span style="color: #f810b0;">20</span> <span style="color: #ff4400; font-weight: bold;">private</span><span style="color: #c0c0c0;">:</span><br /> <span style="color: #696969;">21</span>     <span style="color: #c0c0c0;">Ui</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">Widget</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">ui</span>;<br /> <span style="color: #696969;">22</span>     <span style="color: #c0c0c0;">QUdpSocket</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">sender</span>;<br /> <span style="color: #696969;">23</span> <span style="color: #c0c0c0;">};</span><br /> <span style="color: #696969;">24</span><br /> <span style="color: #f810b0;">25</span> <span style="color: #ffffff;">#endif </span><span style="color: #696969;">// WIDGET_H</span>
</div>

<span style="color: #ff6600;">Receiver</span>

.cpp

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #c0c0c0; background-color: #000000;">
  <span style="color: #696969;">01</span> <span style="color: #ffffff;">#include &#8220;widget.h&#8221;</span><br /> <span style="color: #696969;">02</span> <span style="color: #ffffff;">#include &#8220;ui_widget.h&#8221;</span><br /> <span style="color: #696969;">03</span><br /> <span style="color: #696969;">04</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">Widget</span>(<span style="color: #c0c0c0;">QWidget</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">parent</span>) <span style="color: #c0c0c0;">:</span><br /> <span style="color: #f810b0;">05</span>     <span style="color: #c0c0c0;">QWidget</span>(<span style="color: #c0c0c0;">parent</span><span style="color: #c0c0c0;">),</span><br /> <span style="color: #696969;">06</span>     <span style="color: #c0c0c0;">ui</span>(<span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">Ui</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">Widget</span>)<br /> <span style="color: #696969;">07</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">08</span>     <span style="color: #c0c0c0;">ui</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">setupUi</span>(<span style="color: #ff4400; font-weight: bold;">this</span>);<br /> <span style="color: #696969;">09</span>     <span style="color: #c0c0c0;">receiver</span><span style="color: #c0c0c0;">=</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">QUdpSocket</span>(<span style="color: #ff4400; font-weight: bold;">this</span>);<br /> <span style="color: #f810b0;">10</span>     <span style="color: #c0c0c0;">receiver</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">bind</span>(<span style="color: #c0c0c0;">45454</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">QUdpSocket</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">ShareAddress</span>);<br /> <span style="color: #696969;">11</span>     <span style="color: #c0c0c0;">connect</span>(<span style="color: #c0c0c0;">receiver</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">SIGNAL</span>(<span style="color: #c0c0c0;">readyRead</span><span style="color: #c0c0c0;">()),</span><span style="color: #ff4400; font-weight: bold;">this</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">SLOT</span>(<span style="color: #c0c0c0;">processPendingDatagram</span>()));<br /> <span style="color: #696969;">12</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">13</span><br /> <span style="color: #696969;">14</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::~</span><span style="color: #c0c0c0;">Widget</span>()<br /> <span style="color: #f810b0;">15</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">16</span>     <span style="color: #ff4400; font-weight: bold;">delete</span> <span style="color: #c0c0c0;">ui</span>;<br /> <span style="color: #696969;">17</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">18</span> <span style="color: #ffffff;">void</span> <span style="color: #c0c0c0;">Widget</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">processPendingDatagram</span>()<br /> <span style="color: #696969;">19</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">20</span>     <span style="color: #ff4400; font-weight: bold;">while</span>(<span style="color: #c0c0c0;">receiver</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">hasPendingDatagrams</span>())<br /> <span style="color: #696969;">21</span>     <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">22</span>         <span style="color: #c0c0c0;">QByteArray</span> <span style="color: #c0c0c0;">datagram</span>;<br /> <span style="color: #696969;">23</span>         <span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">resize</span>(<span style="color: #c0c0c0;">receiver</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">pendingDatagramSize</span>());<br /> <span style="color: #696969;">24</span>         <span style="color: #c0c0c0;">receiver</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">readDatagram</span>(<span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">data</span><span style="color: #c0c0c0;">(),</span><span style="color: #c0c0c0;">datagram</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">size</span>());<br /> <span style="color: #f810b0;">25</span>         <span style="color: #c0c0c0;">ui</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">label</span><span style="color: #c0c0c0;">-></span><span style="color: #c0c0c0;">setText</span>(<span style="color: #c0c0c0;">datagram</span>);<br /> <span style="color: #696969;">26</span><br /> <span style="color: #696969;">27</span>     <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">28</span> <span style="color: #c0c0c0;">}</span>
</div>

.h

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #c0c0c0; background-color: #000000;">
  <span style="color: #696969;">01</span> <span style="color: #ffffff;">#ifndef WIDGET_H</span><br /> <span style="color: #696969;">02</span> <span style="color: #ffffff;">#define WIDGET_H</span><br /> <span style="color: #696969;">03</span><br /> <span style="color: #696969;">04</span> <span style="color: #ffffff;">#include <QWidget></span><br /> <span style="color: #f810b0;">05</span> <span style="color: #ffffff;">#include <QtNetwork></span><br /> <span style="color: #696969;">06</span> <span style="color: #ff4400; font-weight: bold;">namespace</span> <span style="color: #c0c0c0;">Ui</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">07</span>     <span style="color: #ff4400; font-weight: bold;">class</span> <span style="color: #c0c0c0;">Widget</span>;<br /> <span style="color: #696969;">08</span> <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">09</span><br /> <span style="color: #f810b0;">10</span> <span style="color: #ff4400; font-weight: bold;">class</span> <span style="color: #c0c0c0;">Widget</span> <span style="color: #c0c0c0;">:</span> <span style="color: #ff4400; font-weight: bold;">public</span> <span style="color: #c0c0c0;">QWidget</span><br /> <span style="color: #696969;">11</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">12</span>     <span style="color: #c0c0c0;">Q_OBJECT</span><br /> <span style="color: #696969;">13</span><br /> <span style="color: #696969;">14</span> <span style="color: #ff4400; font-weight: bold;">public</span><span style="color: #c0c0c0;">:</span><br /> <span style="color: #f810b0;">15</span>     <span style="color: #ff4400; font-weight: bold;">explicit</span> <span style="color: #c0c0c0;">Widget</span>(<span style="color: #c0c0c0;">QWidget</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">parent</span> <span style="color: #c0c0c0;">=</span> <span style="color: #c0c0c0;"></span>);<br /> <span style="color: #696969;">16</span>     <span style="color: #c0c0c0;">~</span><span style="color: #c0c0c0;">Widget</span>();<br /> <span style="color: #696969;">17</span> <span style="color: #ff4400; font-weight: bold;">private</span> <span style="color: #c0c0c0;">slots:</span><br /> <span style="color: #696969;">18</span>     <span style="color: #ffffff;">void</span> <span style="color: #c0c0c0;">processPendingDatagram</span>();<br /> <span style="color: #696969;">19</span> <span style="color: #ff4400; font-weight: bold;">private</span><span style="color: #c0c0c0;">:</span><br /> <span style="color: #f810b0;">20</span>     <span style="color: #c0c0c0;">Ui</span><span style="color: #c0c0c0;">::</span><span style="color: #c0c0c0;">Widget</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">ui</span>;<br /> <span style="color: #696969;">21</span>     <span style="color: #c0c0c0;">QUdpSocket</span> <span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">receiver</span>;<br /> <span style="color: #696969;">22</span> <span style="color: #c0c0c0;">};</span><br /> <span style="color: #696969;">23</span><br /> <span style="color: #696969;">24</span> <span style="color: #ffffff;">#endif </span><span style="color: #696969;">// WIDGET_H</span>
</div>

<span style="color: #ff6600;"><a href="http://down.qiannao.com/space/file/flowerowl/-4e0a-4f20-5206-4eab/Lazy_com.rar/.page" target="_blank"><span style="color: #ff6600;">下载源码</span></a></span>

转载请注明：[于哲的博客][1] &raquo; [Qt学习笔记(2)：Udp局域网通信][2]

 [1]: http://localhost/wordpress
 [2]: http://localhost/wordpress/542.html