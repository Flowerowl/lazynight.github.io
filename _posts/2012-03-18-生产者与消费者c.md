---
title: '生产者与消费者(C#)'
author: Flowerowl
layout: post
permalink: /1656.html
duoshuo_thread_id:
  - 1266988
views:
  - 955
bot_views:
  - 3
categories:
  - 'C#'
  - 代码
tags:
  - OS
---
  
<img class="aligncenter size-full wp-image-1657" title="Lazynight" src="http://lazynight.me/wp-content/uploads/2012/03/Lazynight1.gif" alt="" width="476" height="252" />

这图片500KB，还凑活。以下程序运行模样如上图。

PS：今天没去图书馆，没去食堂，头有点晕。

还有，上边贴的那首歌怎么样，摇滚，我感觉还不错。

还有，我整天写代码，心仍感不足，仍愧疚，虽然已经到了极限。

累，

持续用声音刺激神经。

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #f6f3e8; background-color: #242424;">
  <span style="color: #99968b; font-style: italic;">001</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System</span>;<br /> <span style="color: #99968b; font-style: italic;">002</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.Collections.Generic</span>;<br /> <span style="color: #99968b; font-style: italic;">003</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.ComponentModel</span>;<br /> <span style="color: #99968b; font-style: italic;">004</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.Data</span>;<br /> <span style="color: #f810b0;">005</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.Drawing</span>;<br /> <span style="color: #99968b; font-style: italic;">006</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.Text</span>;<br /> <span style="color: #99968b; font-style: italic;">007</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.Windows.Forms</span>;<br /> <span style="color: #99968b; font-style: italic;">008</span> <span style="color: #8ac6f2;">using</span> <span style="color: #f6f3e8;">System.Threading</span>;<br /> <span style="color: #99968b; font-style: italic;">009</span><br /> <span style="color: #f810b0;">010</span> <span style="color: #8ac6f2;">namespace</span> <span style="color: #f6f3e8;">Producer_and_Consumer</span><br /> <span style="color: #99968b; font-style: italic;">011</span> <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">012</span>     <span style="color: #8ac6f2;">public</span> <span style="color: #8ac6f2;">partial</span> <span style="color: #8ac6f2;">class</span> <span style="color: #f6f3e8;">Form1</span> <span style="color: #f6f3e8;">:</span> <span style="color: #f6f3e8;">Form</span><br /> <span style="color: #99968b; font-style: italic;">013</span>     <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">014</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>;<span style="color: #99968b; font-style: italic;">//缓冲池数目</span><br /> <span style="color: #f810b0;">015</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">Pnum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>;<span style="color: #99968b; font-style: italic;">//生产者数目</span><br /> <span style="color: #99968b; font-style: italic;">016</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">Cnum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>;<span style="color: #99968b; font-style: italic;">//消费者数目</span><br /> <span style="color: #99968b; font-style: italic;">017</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">bool</span> <span style="color: #f6f3e8;">isPRunning</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<span style="color: #99968b; font-style: italic;">//生产者线程状态</span><br /> <span style="color: #99968b; font-style: italic;">018</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">bool</span> <span style="color: #f6f3e8;">isCRunning</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<span style="color: #99968b; font-style: italic;">//消费者线程状态</span><br /> <span style="color: #99968b; font-style: italic;">019</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>;<span style="color: #99968b; font-style: italic;">//生产数目</span><br /> <span style="color: #f810b0;">020</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">outCnum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>;<span style="color: #99968b; font-style: italic;">//消费数目</span><br /> <span style="color: #99968b; font-style: italic;">021</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>;<span style="color: #99968b; font-style: italic;">//进度条百分比</span><br /> <span style="color: #99968b; font-style: italic;">022</span><br /> <span style="color: #99968b; font-style: italic;">023</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">delegate</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">PDelegate</span>(<span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">num</span>);<span style="color: #99968b; font-style: italic;">//生产者委托</span><br /> <span style="color: #99968b; font-style: italic;">024</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">delegate</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">CDelegate</span>(<span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">num</span>);<span style="color: #99968b; font-style: italic;">//消费者委托</span><br /> <span style="color: #f810b0;">025</span><br /> <span style="color: #99968b; font-style: italic;">026</span>         <span style="color: #8ac6f2;">public</span> <span style="color: #cae682;">Form1</span>()<br /> <span style="color: #99968b; font-style: italic;">027</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">028</span>             <span style="color: #f6f3e8;">InitializeComponent</span>();<br /> <span style="color: #99968b; font-style: italic;">029</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #f810b0;">030</span><br /> <span style="color: #99968b; font-style: italic;">031</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">Form1_Load</span>(<span style="color: #cae682;">object</span> <span style="color: #f6f3e8;">sender</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">EventArgs</span> <span style="color: #f6f3e8;">e</span>)<br /> <span style="color: #99968b; font-style: italic;">032</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">033</span>             <span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;10&#8243;</span>;<span style="color: #99968b; font-style: italic;">//初始化生产者数目</span><br /> <span style="color: #99968b; font-style: italic;">034</span>             <span style="color: #f6f3e8;">consumerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;4&#8243;</span>;<span style="color: #99968b; font-style: italic;">//初始化消费者数目</span><br /> <span style="color: #f810b0;">035</span>             <span style="color: #f6f3e8;">stopBtn</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Enabled</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<br /> <span style="color: #99968b; font-style: italic;">036</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">037</span><br /> <span style="color: #99968b; font-style: italic;">038</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">button1_Click</span>(<span style="color: #cae682;">object</span> <span style="color: #f6f3e8;">sender</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">EventArgs</span> <span style="color: #f6f3e8;">e</span>)<span style="color: #99968b; font-style: italic;">//开始</span><br /> <span style="color: #99968b; font-style: italic;">039</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #f810b0;">040</span>             <span style="color: #f6f3e8;">stopBtn</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Enabled</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #99968b; font-style: italic;">041</span>             <span style="color: #f6f3e8;">startBtn</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Enabled</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<br /> <span style="color: #99968b; font-style: italic;">042</span>             <span style="color: #8ac6f2;">try</span><br /> <span style="color: #99968b; font-style: italic;">043</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">044</span>                 <span style="color: #cae682;">int</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Parse</span>(<span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span>);<br /> <span style="color: #f810b0;">045</span>                 <span style="color: #cae682;">int</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Parse</span>(<span style="color: #f6f3e8;">consumerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span>);<br /> <span style="color: #99968b; font-style: italic;">046</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">047</span>             <span style="color: #8ac6f2;">catch</span><br /> <span style="color: #99968b; font-style: italic;">048</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">049</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">MessageBox</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Show</span>(<span style="color: #95e454; font-style: italic;">&#8220;请输入数字&#8221;</span><span style="color: #f6f3e8;">,</span> <span style="color: #95e454; font-style: italic;">&#8220;错误&#8221;</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">MessageBoxButtons</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">OKCancel</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">MessageBoxIcon</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Warning</span>) <span style="color: #f6f3e8;">==</span> <span style="color: #f6f3e8;">DialogResult</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">OK</span>)<br /> <span style="color: #f810b0;">050</span>                 <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">051</span>                     <span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Clear</span>();<br /> <span style="color: #99968b; font-style: italic;">052</span>                     <span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Focus</span>();<br /> <span style="color: #99968b; font-style: italic;">053</span>                     <span style="color: #f6f3e8;">consumerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Clear</span>();<br /> <span style="color: #99968b; font-style: italic;">054</span>                     <span style="color: #f6f3e8;">startBtn</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Enabled</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #f810b0;">055</span>                 <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">056</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">057</span>             <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">==</span> <span style="color: #95e454; font-style: italic;">&#8220;&#8221;</span> || <span style="color: #f6f3e8;">consumerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">==</span> <span style="color: #95e454; font-style: italic;">&#8220;&#8221;</span>)<br /> <span style="color: #99968b; font-style: italic;">058</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">059</span>                 <span style="color: #f6f3e8;">MessageBox</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Show</span>(<span style="color: #8ac6f2;">this</span><span style="color: #f6f3e8;">,</span> <span style="color: #95e454; font-style: italic;">&#8220;请输入数目&#8221;</span><span style="color: #f6f3e8;">,</span> <span style="color: #95e454; font-style: italic;">&#8220;错误&#8221;</span>);<br /> <span style="color: #f810b0;">060</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">061</span>             <span style="color: #8ac6f2;">else</span><br /> <span style="color: #99968b; font-style: italic;">062</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">063</span>                 <span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">Convert</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ToInt32</span>(<span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span>);<span style="color: #99968b; font-style: italic;">//获取生产者数目</span><br /> <span style="color: #99968b; font-style: italic;">064</span>                 <span style="color: #f6f3e8;">outCnum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">Convert</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ToInt32</span>(<span style="color: #f6f3e8;">consumerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span>);<span style="color: #99968b; font-style: italic;">//获取消费者数目</span><br /> <span style="color: #f810b0;">065</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">066</span>             <span style="color: #8ac6f2;">for</span> (<span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">i</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>; <span style="color: #f6f3e8;">i</span> <span style="color: #f6f3e8;"><</span> <span style="color: #f6f3e8;">outPnum</span>; <span style="color: #f6f3e8;">i</span><span style="color: #f6f3e8;">++)</span><br /> <span style="color: #99968b; font-style: italic;">067</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">068</span>                 <span style="color: #f6f3e8;">Thread</span> <span style="color: #f6f3e8;">pthread</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">new</span> <span style="color: #f6f3e8;">Thread</span>(<span style="color: #f6f3e8;">PMethod</span>);<br /> <span style="color: #99968b; font-style: italic;">069</span>                 <span style="color: #f6f3e8;">isPRunning</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #f810b0;">070</span>                 <span style="color: #f6f3e8;">pthread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">IsBackground</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #99968b; font-style: italic;">071</span>                 <span style="color: #f6f3e8;">pthread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Start</span>();<br /> <span style="color: #99968b; font-style: italic;">072</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">073</span>             <span style="color: #8ac6f2;">for</span> (<span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">j</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>; <span style="color: #f6f3e8;">j</span> <span style="color: #f6f3e8;"><</span> <span style="color: #f6f3e8;">outCnum</span>; <span style="color: #f6f3e8;">j</span><span style="color: #f6f3e8;">++)</span><br /> <span style="color: #99968b; font-style: italic;">074</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #f810b0;">075</span>                 <span style="color: #f6f3e8;">Thread</span> <span style="color: #f6f3e8;">cthread</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">new</span> <span style="color: #f6f3e8;">Thread</span>(<span style="color: #f6f3e8;">CMethod</span>);<br /> <span style="color: #99968b; font-style: italic;">076</span>                 <span style="color: #f6f3e8;">isCRunning</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #99968b; font-style: italic;">077</span>                 <span style="color: #f6f3e8;">cthread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">IsBackground</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #99968b; font-style: italic;">078</span>                 <span style="color: #f6f3e8;">cthread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Start</span>();<br /> <span style="color: #99968b; font-style: italic;">079</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #f810b0;">080</span><br /> <span style="color: #99968b; font-style: italic;">081</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">082</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">PMethod</span>()<span style="color: #99968b; font-style: italic;">//生产者方法</span><br /> <span style="color: #99968b; font-style: italic;">083</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">084</span>             <span style="color: #8ac6f2;">while</span> (<span style="color: #f6f3e8;">isPRunning</span>)<br /> <span style="color: #f810b0;">085</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">086</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;"><</span> <span style="color: #e5786d;">100</span>)<br /> <span style="color: #99968b; font-style: italic;">087</span>                 <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">088</span>                     <span style="color: #f6f3e8;">Pnum</span><span style="color: #f6f3e8;">++;</span><br /> <span style="color: #99968b; font-style: italic;">089</span>                     <span style="color: #f6f3e8;">PAdd</span>(<span style="color: #f6f3e8;">Pnum</span>);<br /> <span style="color: #f810b0;">090</span>                     <span style="color: #f6f3e8;">Thread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Sleep</span>(<span style="color: #e5786d;">1000</span>);<br /> <span style="color: #99968b; font-style: italic;">091</span>                 <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">092</span>                 <span style="color: #8ac6f2;">else</span><br /> <span style="color: #99968b; font-style: italic;">093</span>                 <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">094</span>                     <span style="color: #f6f3e8;">PAdd</span>(<span style="color: #f6f3e8;">Pnum</span><span style="color: #f6f3e8;">++);</span><br /> <span style="color: #f810b0;">095</span>                     <span style="color: #f6f3e8;">Thread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Sleep</span>(<span style="color: #e5786d;">1000</span>);<br /> <span style="color: #99968b; font-style: italic;">096</span>                 <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">097</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">098</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">099</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">PAdd</span>(<span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">num</span>)<br /> <span style="color: #f810b0;">100</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">101</span>             <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">producerText</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">InvokeRequired</span>)<br /> <span style="color: #99968b; font-style: italic;">102</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">103</span>                 <span style="color: #f6f3e8;">PDelegate</span> p <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">new</span> <span style="color: #f6f3e8;">PDelegate</span>(<span style="color: #f6f3e8;">PAdd</span>);<br /> <span style="color: #99968b; font-style: italic;">104</span>                 <span style="color: #f6f3e8;">productNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Invoke</span>(p<span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">num</span>);<br /> <span style="color: #f810b0;">105</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">106</span>             <span style="color: #8ac6f2;">else</span><br /> <span style="color: #99968b; font-style: italic;">107</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">108</span>                 <span style="color: #f6f3e8;">productNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;&#8221;</span>;<br /> <span style="color: #99968b; font-style: italic;">109</span>                 <span style="color: #f6f3e8;">productNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">AppendText</span>(<span style="color: #f6f3e8;">Convert</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ToString</span>(<span style="color: #f6f3e8;">num</span>));<br /> <span style="color: #f810b0;">110</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">-</span> <span style="color: #f6f3e8;">outCnum</span> <span style="color: #f6f3e8;">></span> <span style="color: #e5786d;">100</span>)<br /> <span style="color: #99968b; font-style: italic;">111</span>                 <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;">100</span>; <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">112</span>                 <span style="color: #8ac6f2;">else</span> <span style="color: #cae682;">if</span> (<span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">-</span> <span style="color: #f6f3e8;">outCnum</span> <span style="color: #f6f3e8;"><</span> <span style="color: #e5786d;"></span>)<br /> <span style="color: #99968b; font-style: italic;">113</span>                 <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>; <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">114</span>                 <span style="color: #8ac6f2;">else</span><br /> <span style="color: #f810b0;">115</span>                 <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">-</span> <span style="color: #f6f3e8;">outCnum</span>; <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">116</span>                 <span style="color: #f6f3e8;">poolCount</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">Convert</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ToString</span>(<span style="color: #f6f3e8;">PoolNum</span>);<br /> <span style="color: #99968b; font-style: italic;">117</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">118</span>             <span style="color: #8ac6f2;">try</span><br /> <span style="color: #99968b; font-style: italic;">119</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #f810b0;">120</span>                 <span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;">=</span> (<span style="color: #cae682;">int</span>)(<span style="color: #e5786d;">100</span> <span style="color: #f6f3e8;">*</span> (((<span style="color: #cae682;">float</span>)<span style="color: #f6f3e8;">Pnum</span> <span style="color: #f6f3e8;">-</span> (<span style="color: #cae682;">float</span>)<span style="color: #f6f3e8;">Cnum</span>) <span style="color: #f6f3e8;">/</span> <span style="color: #e5786d;">100.0</span>));<br /> <span style="color: #99968b; font-style: italic;">121</span>                 <span style="color: #f6f3e8;">progressBar1</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Value</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">persent</span>;<br /> <span style="color: #99968b; font-style: italic;">122</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;">>=</span> <span style="color: #e5786d;">100</span>)<br /> <span style="color: #99968b; font-style: italic;">123</span>                     <span style="color: #f6f3e8;">label6</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;生产者等待中&#8230;&#8221;</span>;<br /> <span style="color: #99968b; font-style: italic;">124</span>                 <span style="color: #8ac6f2;">else</span><br /> <span style="color: #f810b0;">125</span>                     <span style="color: #f6f3e8;">label6</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;未等待&#8221;</span>;<br /> <span style="color: #99968b; font-style: italic;">126</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">127</span>             <span style="color: #8ac6f2;">catch</span> <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">128</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">129</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">CMethod</span>()<span style="color: #99968b; font-style: italic;">//消费者方法</span><br /> <span style="color: #f810b0;">130</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">131</span>             <span style="color: #8ac6f2;">while</span> (<span style="color: #f6f3e8;">isCRunning</span>)<br /> <span style="color: #99968b; font-style: italic;">132</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">133</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;">></span> <span style="color: #e5786d;"></span>)<br /> <span style="color: #99968b; font-style: italic;">134</span>                 <span style="color: #f6f3e8;">{</span><br /> <span style="color: #f810b0;">135</span>                     <span style="color: #f6f3e8;">Cnum</span><span style="color: #f6f3e8;">++;</span><br /> <span style="color: #99968b; font-style: italic;">136</span>                     <span style="color: #f6f3e8;">CAdd</span>(<span style="color: #f6f3e8;">Cnum</span>);<br /> <span style="color: #99968b; font-style: italic;">137</span>                     <span style="color: #f6f3e8;">Thread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Sleep</span>(<span style="color: #e5786d;">1000</span>);<br /> <span style="color: #99968b; font-style: italic;">138</span>                 <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">139</span>                 <span style="color: #8ac6f2;">else</span><br /> <span style="color: #f810b0;">140</span>                 <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">141</span>                     <span style="color: #f6f3e8;">CAdd</span>(<span style="color: #f6f3e8;">Cnum</span><span style="color: #f6f3e8;">++);</span><br /> <span style="color: #99968b; font-style: italic;">142</span>                     <span style="color: #f6f3e8;">Thread</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Sleep</span>(<span style="color: #e5786d;">1000</span>);<br /> <span style="color: #99968b; font-style: italic;">143</span>                 <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">144</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #f810b0;">145</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">146</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">CAdd</span>(<span style="color: #cae682;">int</span> <span style="color: #f6f3e8;">num</span>)<br /> <span style="color: #99968b; font-style: italic;">147</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">148</span>             <span style="color: #8ac6f2;">if</span> ( <span style="color: #f6f3e8;">consumeNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">InvokeRequired</span>)<br /> <span style="color: #99968b; font-style: italic;">149</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #f810b0;">150</span>                 <span style="color: #f6f3e8;">CDelegate</span> <span style="color: #f6f3e8;">c</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">new</span> <span style="color: #f6f3e8;">CDelegate</span>(<span style="color: #f6f3e8;">CAdd</span>);<br /> <span style="color: #99968b; font-style: italic;">151</span>                 <span style="color: #f6f3e8;">consumeNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Invoke</span>(<span style="color: #f6f3e8;">c</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">num</span>);<br /> <span style="color: #99968b; font-style: italic;">152</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">153</span>             <span style="color: #8ac6f2;">else</span><br /> <span style="color: #99968b; font-style: italic;">154</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #f810b0;">155</span>                 <span style="color: #f6f3e8;">consumeNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;&#8221;</span>;<br /> <span style="color: #99968b; font-style: italic;">156</span>                 <span style="color: #f6f3e8;">consumeNum</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">AppendText</span>(<span style="color: #f6f3e8;">Convert</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ToString</span>(<span style="color: #f6f3e8;">num</span>));<br /> <span style="color: #99968b; font-style: italic;">157</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">-</span> <span style="color: #f6f3e8;">outCnum</span><span style="color: #f6f3e8;"><</span> <span style="color: #e5786d;"></span>)<br /> <span style="color: #99968b; font-style: italic;">158</span>                 <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;"></span>; <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">159</span>                 <span style="color: #8ac6f2;">else</span> <span style="color: #cae682;">if</span> (<span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">-</span> <span style="color: #f6f3e8;">outCnum</span> <span style="color: #f6f3e8;">>=</span><span style="color: #e5786d;">100</span>)<br /> <span style="color: #f810b0;">160</span>                 <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #e5786d;">100</span>; <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">161</span>                 <span style="color: #8ac6f2;">else</span><br /> <span style="color: #99968b; font-style: italic;">162</span>                 <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">PoolNum</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">outPnum</span> <span style="color: #f6f3e8;">-</span> <span style="color: #f6f3e8;">outCnum</span>; <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">163</span>                 <span style="color: #f6f3e8;">poolCount</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">Convert</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ToString</span>(<span style="color: #f6f3e8;">PoolNum</span>);<br /> <span style="color: #99968b; font-style: italic;">164</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #f810b0;">165</span>             <span style="color: #8ac6f2;">try</span><br /> <span style="color: #99968b; font-style: italic;">166</span>             <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">167</span>                 <span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;">=</span> (<span style="color: #cae682;">int</span>)(<span style="color: #e5786d;">100</span> <span style="color: #f6f3e8;">*</span> (((<span style="color: #cae682;">float</span>)<span style="color: #f6f3e8;">Pnum</span> <span style="color: #f6f3e8;">-</span> (<span style="color: #cae682;">float</span>)<span style="color: #f6f3e8;">Cnum</span>) <span style="color: #f6f3e8;">/</span> <span style="color: #e5786d;">100.0</span>));<br /> <span style="color: #99968b; font-style: italic;">168</span>                 <span style="color: #f6f3e8;">progressBar1</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Value</span> <span style="color: #f6f3e8;">=</span> <span style="color: #f6f3e8;">persent</span>;<br /> <span style="color: #99968b; font-style: italic;">169</span>                 <span style="color: #8ac6f2;">if</span> (<span style="color: #f6f3e8;">persent</span> <span style="color: #f6f3e8;"><=</span> <span style="color: #e5786d;"></span>)<br /> <span style="color: #f810b0;">170</span>                     <span style="color: #f6f3e8;">label7</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;消费者等待中&#8230;&#8221;</span>;<br /> <span style="color: #99968b; font-style: italic;">171</span>                 <span style="color: #8ac6f2;">else</span><br /> <span style="color: #99968b; font-style: italic;">172</span>                     <span style="color: #f6f3e8;">label7</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Text</span> <span style="color: #f6f3e8;">=</span> <span style="color: #95e454; font-style: italic;">&#8220;未等待&#8221;</span>;<br /> <span style="color: #99968b; font-style: italic;">173</span>             <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">174</span>             <span style="color: #8ac6f2;">catch</span> <span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">}</span><br /> <span style="color: #f810b0;">175</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">176</span><br /> <span style="color: #99968b; font-style: italic;">177</span>         <span style="color: #8ac6f2;">private</span> <span style="color: #8ac6f2;">void</span> <span style="color: #cae682;">stopBtn_Click</span>(<span style="color: #cae682;">object</span> <span style="color: #f6f3e8;">sender</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">EventArgs</span> <span style="color: #f6f3e8;">e</span>)<br /> <span style="color: #99968b; font-style: italic;">178</span>         <span style="color: #f6f3e8;">{</span><br /> <span style="color: #99968b; font-style: italic;">179</span>             <span style="color: #f6f3e8;">isPRunning</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<br /> <span style="color: #f810b0;">180</span>             <span style="color: #f6f3e8;">isCRunning</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<br /> <span style="color: #99968b; font-style: italic;">181</span>             <span style="color: #f6f3e8;">startBtn</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Enabled</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">true</span>;<br /> <span style="color: #99968b; font-style: italic;">182</span>             <span style="color: #f6f3e8;">stopBtn</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">Enabled</span> <span style="color: #f6f3e8;">=</span> <span style="color: #8ac6f2;">false</span>;<br /> <span style="color: #99968b; font-style: italic;">183</span>         <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">184</span><br /> <span style="color: #f810b0;">185</span>     <span style="color: #f6f3e8;">}</span><br /> <span style="color: #99968b; font-style: italic;">186</span> <span style="color: #f6f3e8;">}</span>
</div>

转载请注明：[于哲的博客][1] &raquo; [生产者与消费者(C#)][2]

 [1]: http://localhost/wordpress
 [2]: http://localhost/wordpress/1656.html