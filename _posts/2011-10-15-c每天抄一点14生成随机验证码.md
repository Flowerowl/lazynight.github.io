---
title: 'C#每天抄一点(14):生成随机验证码'
author: Flowerowl
layout: post
permalink: /501.html
duoshuo_thread_id:
  - 1266851
views:
  - 737
bot_views:
  - 2
categories:
  - 'C#'
  - 代码
---
  
昨天没写完寝室就断电了，今天发14和15节。咬牙坚持下去撒&#8230;&#8230;

<img class="aligncenter size-full wp-image-505" title="Lazynight | 夜阑" src="http://lazynight.me/wp-content/uploads/2011/10/20111015222735.jpg" alt="" width="248" height="59" /><img class="aligncenter size-full wp-image-504" title="Lazynight | 夜阑" src="http://lazynight.me/wp-content/uploads/2011/10/20111015222728.jpg" alt="" width="248" height="59" /><img class="aligncenter size-full wp-image-503" title="Lazynight | 夜阑" src="http://lazynight.me/wp-content/uploads/2011/10/20111015222722.jpg" alt="" width="248" height="59" />

&nbsp;

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #c0c0c0; background-color: #000000;">
  <span style="color: #696969;">01</span> <span style="color: #696969;">/*</span><br /> <span style="color: #696969;">02</span> <span style="color: #696969;"> * 由SharpDevelop创建。</span><br /> <span style="color: #696969;">03</span> <span style="color: #696969;"> * 用户： Lazynight</span><br /> <span style="color: #696969;">04</span> <span style="color: #696969;"> * 日期: 2011/10/15</span><br /> <span style="color: #f810b0;">05</span> <span style="color: #696969;"> * 时间: 20:10</span><br /> <span style="color: #696969;">06</span> <span style="color: #696969;"> * </span><br /> <span style="color: #696969;">07</span> <span style="color: #696969;"> * 要改变这种模板请点击 工具|选项|代码编写|编辑标准头文件</span><br /> <span style="color: #696969;">08</span> <span style="color: #696969;"> */</span><br /> <span style="color: #696969;">09</span> <span style="color: #ff4400; font-weight: bold;">using</span> <span style="color: #c0c0c0;">System</span>;<br /> <span style="color: #f810b0;">10</span> <span style="color: #ff4400; font-weight: bold;">using</span> <span style="color: #c0c0c0;">System.Collections.Generic</span>;<br /> <span style="color: #696969;">11</span> <span style="color: #ff4400; font-weight: bold;">using</span> <span style="color: #c0c0c0;">System.Drawing</span>;<br /> <span style="color: #696969;">12</span> <span style="color: #ff4400; font-weight: bold;">using</span> <span style="color: #c0c0c0;">System.Windows.Forms</span>;<br /> <span style="color: #696969;">13</span><br /> <span style="color: #696969;">14</span> <span style="color: #ff4400; font-weight: bold;">namespace</span> <span style="color: #c0c0c0;">Lazy14_</span><span style="color: #c0c0c0;">随机生成验证码</span><br /> <span style="color: #f810b0;">15</span> <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">16</span>     <span style="color: #ff4400; font-weight: bold;">public</span> <span style="color: #ff4400; font-weight: bold;">partial</span> <span style="color: #ff4400; font-weight: bold;">class</span> <span style="color: #c0c0c0;">MainForm</span> <span style="color: #c0c0c0;">:</span> <span style="color: #c0c0c0;">Form</span><br /> <span style="color: #696969;">17</span>     <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">18</span>         <span style="color: #ff4400; font-weight: bold;">public</span> <span style="color: #ffff00;">MainForm</span>()<br /> <span style="color: #696969;">19</span>         <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">20</span>             <span style="color: #c0c0c0;">InitializeComponent</span>();<br /> <span style="color: #696969;">21</span>         <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">22</span>         <span style="color: #ff4400; font-weight: bold;">private</span> <span style="color: #ffffff;">string</span> <span style="color: #ffff00;">LazyCode</span>()<br /> <span style="color: #696969;">23</span>         <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">24</span>             <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">num</span>;<br /> <span style="color: #f810b0;">25</span>             <span style="color: #ffffff;">char</span> <span style="color: #c0c0c0;">code</span>;<br /> <span style="color: #696969;">26</span>             <span style="color: #ffffff;">string</span> <span style="color: #c0c0c0;">lazy_code</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">String</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Empty</span>;<br /> <span style="color: #696969;">27</span>             <span style="color: #c0c0c0;">Random</span> <span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">=</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">Random</span>();<br /> <span style="color: #696969;">28</span>             <span style="color: #ff4400; font-weight: bold;">for</span>(<span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;"></span>;<span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;"><</span><span style="color: #c0c0c0;">4</span>;<span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;">++)</span><br /> <span style="color: #696969;">29</span>             <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">30</span>                 <span style="color: #c0c0c0;">num</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>();<br /> <span style="color: #696969;">31</span>                 <span style="color: #ff4400; font-weight: bold;">if</span>(<span style="color: #c0c0c0;">num</span><span style="color: #c0c0c0;">%</span><span style="color: #c0c0c0;">2</span><span style="color: #c0c0c0;">==</span><span style="color: #c0c0c0;"></span>)<br /> <span style="color: #696969;">32</span>                     <span style="color: #c0c0c0;">code</span><span style="color: #c0c0c0;">=(</span><span style="color: #ffffff;">char</span>)(<span style="color: #d13800;">&#8217;0&#8242;</span><span style="color: #c0c0c0;">+(</span><span style="color: #ffffff;">char</span>)(<span style="color: #c0c0c0;">num</span><span style="color: #c0c0c0;">%</span><span style="color: #c0c0c0;">10</span>));<span style="color: #696969;">//随机生成0~9,即00,01,02,03……09</span><br /> <span style="color: #696969;">33</span>                 <span style="color: #ff4400; font-weight: bold;">else</span><br /> <span style="color: #696969;">34</span>                     <span style="color: #c0c0c0;">code</span><span style="color: #c0c0c0;">=(</span><span style="color: #ffffff;">char</span>)(<span style="color: #d13800;">&#8216;A&#8217;</span><span style="color: #c0c0c0;">+(</span><span style="color: #ffffff;">char</span>)(<span style="color: #c0c0c0;">num</span><span style="color: #c0c0c0;">%</span><span style="color: #c0c0c0;">26</span>));<span style="color: #696969;">//随机生成A~Z，即AA，AB,AC …… AZ</span><br /> <span style="color: #f810b0;">35</span>                 <span style="color: #c0c0c0;">lazy_code</span><span style="color: #c0c0c0;">+=</span><span style="color: #d13800;">&#8221; &#8220;</span><span style="color: #c0c0c0;">+</span><span style="color: #c0c0c0;">code</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">ToString</span>();   <span style="color: #696969;">//lazy_code是一个四位随机字符串</span><br /> <span style="color: #696969;">36</span>             <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">37</span>             <span style="color: #ff4400; font-weight: bold;">return</span> <span style="color: #c0c0c0;">lazy_code</span>;<br /> <span style="color: #696969;">38</span>         <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">39</span>         <span style="color: #ff4400; font-weight: bold;">private</span> <span style="color: #ff4400; font-weight: bold;">void</span> <span style="color: #ffff00;">LazyImage</span>(<span style="color: #ffffff;">string</span> <span style="color: #c0c0c0;">lazy_code</span>)<span style="color: #696969;">////创建由随机数字生成的图片</span><br /> <span style="color: #f810b0;">40</span>         <span style="color: #c0c0c0;">{</span><br /> <span style="color: #696969;">41</span>             <span style="color: #ff4400; font-weight: bold;">if</span>(<span style="color: #c0c0c0;">lazy_code</span><span style="color: #c0c0c0;">==</span><span style="color: #ff4400; font-weight: bold;">null</span> || <span style="color: #c0c0c0;">lazy_code</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Trim</span><span style="color: #c0c0c0;">()==</span><span style="color: #c0c0c0;">String</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Empty</span>)<br /> <span style="color: #696969;">42</span>             <span style="color: #ff4400; font-weight: bold;">return</span>;<br /> <span style="color: #696969;">43</span>             <span style="color: #c0c0c0;">System</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Drawing</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Bitmap</span> <span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">=</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">System</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Drawing</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Bitmap</span>((<span style="color: #ffffff;">int</span>)<span style="color: #c0c0c0;">Math</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Ceiling</span>((<span style="color: #c0c0c0;">lazy_code</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Length</span><span style="color: #c0c0c0;">*</span><span style="color: #c0c0c0;">50.0</span><span style="color: #c0c0c0;">)),</span><span style="color: #c0c0c0;">50</span>);<br /> <span style="color: #696969;">44</span>             <span style="color: #696969;">//新建一个位图,宽度为每个字节50*4个，高度为50</span><br /> <span style="color: #f810b0;">45</span>             <span style="color: #c0c0c0;">Graphics</span> <span style="color: #c0c0c0;">Lazy_pic</span> <span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">Graphics</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">FromImage</span>(<span style="color: #c0c0c0;">image</span>);<span style="color: #696969;">//从画布中取出图片</span><br /> <span style="color: #696969;">46</span>             <span style="color: #c0c0c0;">Random</span> <span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">=</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">Random</span>();<span style="color: #696969;">//生成随机生成器</span><br /> <span style="color: #696969;">47</span>             <span style="color: #c0c0c0;">Lazy_pic</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Clear</span>(<span style="color: #c0c0c0;">Color</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">White</span>);<span style="color: #696969;">//清空图片背景色</span><br /> <span style="color: #696969;">48</span>             <span style="color: #ff4400; font-weight: bold;">for</span>(<span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;"></span>;<span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;"><</span><span style="color: #c0c0c0;">100</span>;<span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;">++)</span>  <span style="color: #696969;">//图片背景噪音线，通过i控制密度</span><br /> <span style="color: #696969;">49</span>             <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">50</span>                 <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">x1</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>(<span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Width</span>);<br /> <span style="color: #696969;">51</span>                 <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">x2</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>(<span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Width</span>);<br /> <span style="color: #696969;">52</span>                 <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">y1</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>(<span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Height</span>);<br /> <span style="color: #696969;">53</span>                 <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">y2</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>(<span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Height</span>);<br /> <span style="color: #696969;">54</span>                 <span style="color: #c0c0c0;">Lazy_pic</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">DrawLine</span>(<span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">Pen</span>(<span style="color: #c0c0c0;">Color</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Black</span><span style="color: #c0c0c0;">),</span><span style="color: #c0c0c0;">x1</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">y1</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">x2</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">y2</span>);<br /> <span style="color: #f810b0;">55</span>             <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">56</span>             <span style="color: #c0c0c0;">Font</span> <span style="color: #c0c0c0;">font</span><span style="color: #c0c0c0;">=</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">System</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Drawing</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Font</span>(<span style="color: #d13800;">&#8220;Arial&#8221;</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">35</span><span style="color: #c0c0c0;">,(</span><span style="color: #c0c0c0;">System</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Drawing</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">FontStyle</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Bold</span>));<br /> <span style="color: #696969;">57</span>             <span style="color: #c0c0c0;">Lazy_pic</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">DrawString</span>(<span style="color: #c0c0c0;">lazy_code</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">font</span><span style="color: #c0c0c0;">,</span><span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">SolidBrush</span>(<span style="color: #c0c0c0;">Color</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Red</span><span style="color: #c0c0c0;">),</span><span style="color: #c0c0c0;">4</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">2</span>);<br /> <span style="color: #696969;">58</span>             <span style="color: #ff4400; font-weight: bold;">for</span>(<span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;"></span>;<span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;"><</span><span style="color: #c0c0c0;">7000</span>;<span style="color: #c0c0c0;">i</span><span style="color: #c0c0c0;">++)</span><span style="color: #696969;">//图片噪点，通过i控制密度</span><br /> <span style="color: #696969;">59</span>             <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">60</span>                 <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">x</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>(<span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Width</span>);<br /> <span style="color: #696969;">61</span>                 <span style="color: #ffffff;">int</span> <span style="color: #c0c0c0;">y</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>(<span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Height</span>);<br /> <span style="color: #696969;">62</span>                 <span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">SetPixel</span>(<span style="color: #c0c0c0;">x</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">y</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">Color</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">FromArgb</span>(<span style="color: #c0c0c0;">lazy_ran</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Next</span>()));<span style="color: #696969;">//分配为随机颜色</span><br /> <span style="color: #696969;">63</span>             <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">64</span>             <span style="color: #c0c0c0;">Lazy_pic</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">DrawRectangle</span>(<span style="color: #ff4400; font-weight: bold;">new</span> <span style="color: #c0c0c0;">Pen</span>(<span style="color: #c0c0c0;">Color</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Silver</span><span style="color: #c0c0c0;">),</span><span style="color: #c0c0c0;"></span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;"></span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Width</span><span style="color: #c0c0c0;">,</span><span style="color: #c0c0c0;">image</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Height</span>);<br /> <span style="color: #f810b0;">65</span>             <span style="color: #ff4400; font-weight: bold;">this</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">pictureBox1</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">BackgroundImage</span><span style="color: #c0c0c0;">=</span><span style="color: #c0c0c0;">image</span>;<br /> <span style="color: #696969;">66</span><br /> <span style="color: #696969;">67</span>         <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">68</span>         <span style="color: #ff4400; font-weight: bold;">void</span> <span style="color: #ffff00;">MainFormLoad</span>(<span style="color: #ffffff;">object</span> <span style="color: #c0c0c0;">sender</span><span style="color: #c0c0c0;">,</span> <span style="color: #c0c0c0;">EventArgs</span> <span style="color: #c0c0c0;">e</span>)<br /> <span style="color: #696969;">69</span>         <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">70</span>             <span style="color: #c0c0c0;">LazyImage</span>(<span style="color: #c0c0c0;">LazyCode</span>());<br /> <span style="color: #696969;">71</span>         <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">72</span><br /> <span style="color: #696969;">73</span>         <span style="color: #ff4400; font-weight: bold;">void</span> <span style="color: #ffff00;">Button1Click</span>(<span style="color: #ffffff;">object</span> <span style="color: #c0c0c0;">sender</span><span style="color: #c0c0c0;">,</span> <span style="color: #c0c0c0;">EventArgs</span> <span style="color: #c0c0c0;">e</span>)<br /> <span style="color: #696969;">74</span>         <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">75</span>             <span style="color: #c0c0c0;">LazyImage</span>(<span style="color: #c0c0c0;">LazyCode</span>());<br /> <span style="color: #696969;">76</span>         <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">77</span><br /> <span style="color: #696969;">78</span>         <span style="color: #ff4400; font-weight: bold;">void</span> <span style="color: #ffff00;">Button2Click</span>(<span style="color: #ffffff;">object</span> <span style="color: #c0c0c0;">sender</span><span style="color: #c0c0c0;">,</span> <span style="color: #c0c0c0;">EventArgs</span> <span style="color: #c0c0c0;">e</span>)<br /> <span style="color: #696969;">79</span>         <span style="color: #c0c0c0;">{</span><br /> <span style="color: #f810b0;">80</span>             <span style="color: #c0c0c0;">Application</span><span style="color: #c0c0c0;">.</span><span style="color: #c0c0c0;">Exit</span>();<br /> <span style="color: #696969;">81</span>         <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">82</span>     <span style="color: #c0c0c0;">}</span><br /> <span style="color: #696969;">83</span> <span style="color: #c0c0c0;">}</span>
</div>

<span style="color: #ff6600;"><a href="http://down.qiannao.com/space/file/flowerowl/-4e0a-4f20-5206-4eab/Lazy14_-968f-673a-751f-6210-9a8c-8bc1-7801.rar/.page" target="_blank"><span style="color: #ff6600;">下载源码</span></a></span>

转载请注明：[于哲的博客][1] &raquo; [C#每天抄一点(14):生成随机验证码][2]

 [1]: http://localhost/wordpress
 [2]: http://localhost/wordpress/501.html