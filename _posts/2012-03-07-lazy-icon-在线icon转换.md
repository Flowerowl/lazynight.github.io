---
title: Lazy Icon—在线Icon转换
author: Flowerowl
layout: post
permalink: /1534.html
duoshuo_thread_id:
  - 1266976
views:
  - 829
bot_views:
  - 3
categories:
  - 作品
tags:
  - Ico
  - 工具箱
---
[<img class="aligncenter size-full wp-image-1535" title="icon" src="http://lazynight.me/wp-content/uploads/2012/03/icon.gif" alt="" width="594" height="284" />][1]

<p style="text-align: center;">
  去年就有了工具箱，那时候是想做一个网盘MP3外链工具。
</p>

<p style="text-align: center;">
  因为喜欢音乐，空间里的外链都需要现找，不稳定。
</p>

<p style="text-align: center;">
  后来也知道了几个破解115或者威盘的方法，最后没做出来，可惜。
</p>

<p style="text-align: center;">
  不过就有了工具箱这个念头。
</p>

<p style="text-align: center;">
  第一个工具是利用威盘的api的上传功能。
</p>

<p style="text-align: center;">
  今天这个是在线转换icon图标。
</p>

<p style="text-align: center;">
  核心代码是别人封装好的php文件。
</p>

<div style="background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #fdfdfd; color: black; text-align: center; background-position: initial initial; background-repeat: initial initial;">
  工具箱地址：<span style="color: #ff6600;"><a href="http://lazynight.me/tools/UP.htm"><span style="color: #ff6600;">http://lazynight.me/tools/UP.htm</span></a></span>
</div>

<div style="background: #fdfdfd; color: black;">
</div>

<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;">
  <span style="color: #7f9f7f;">001</span> <span style="color: #ffcfaf; font-weight: bold;"><?php</span><br /> <span style="color: #7f9f7f;">002</span> <span style="color: #7f9f7f;">////////////////////////////////////////////////////////////// </span><br /> <span style="color: #7f9f7f;">003</span> <span style="color: #7f9f7f;">///  phpThumb() by James Heinrich <info@silisoftware.com>   // </span><br /> <span style="color: #7f9f7f;">004</span> <span style="color: #7f9f7f;">//        available at http://phpthumb.sourceforge.net     /// </span><br /> <span style="color: #f810b0;">005</span> <span style="color: #7f9f7f;">////////////////////////////////////////////////////////////// </span><br /> <span style="color: #7f9f7f;">006</span> <span style="color: #7f9f7f;">///                                                         // </span><br /> <span style="color: #7f9f7f;">007</span> <span style="color: #7f9f7f;">// phpthumb.ico.php &#8211; .ICO output format functions          // </span><br /> <span style="color: #7f9f7f;">008</span> <span style="color: #7f9f7f;">//                                                         /// </span><br /> <span style="color: #7f9f7f;">009</span> <span style="color: #7f9f7f;">////////////////////////////////////////////////////////////// </span><br /> <span style="color: #f810b0;">010</span> <span style="color: #e3ceab;">class</span> <span style="color: #dcdccc;">phpthumb_ico</span> <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">011</span>     <span style="color: #e3ceab;">function</span> <span style="color: #efef8f;">phpthumb_ico</span>() <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">012</span>         <span style="color: #e3ceab;">return</span> <span style="color: #e3ceab;">true</span>;<br /> <span style="color: #7f9f7f;">013</span>     <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">014</span>     <span style="color: #e3ceab;">function</span> <span style="color: #efef8f;">GD2ICOstring</span>(<span style="color: #dcdccc;">&</span><span style="color: #efdcbc;">$gd_image_array</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #f810b0;">015</span>         <span style="color: #e3ceab;">foreach</span> (<span style="color: #efdcbc;">$gd_image_array</span> <span style="color: #e3ceab;">as</span> <span style="color: #efdcbc;">$key</span> <span style="color: #dcdccc;">=></span> <span style="color: #efdcbc;">$gd_image</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">016</span>             <span style="color: #efdcbc;">$ImageWidths</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span>  <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">ImageSX</span>(<span style="color: #efdcbc;">$gd_image</span>);<br /> <span style="color: #7f9f7f;">017</span>             <span style="color: #efdcbc;">$ImageHeights</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">ImageSY</span>(<span style="color: #efdcbc;">$gd_image</span>);<br /> <span style="color: #7f9f7f;">018</span>             <span style="color: #efdcbc;">$bpp</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span>          <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">ImageIsTrueColor</span>(<span style="color: #efdcbc;">$gd_image</span>) <span style="color: #dcdccc;">?</span> <span style="color: #8cd0d3;">32</span> <span style="color: #dcdccc;">:</span> <span style="color: #8cd0d3;">24</span>;<br /> <span style="color: #7f9f7f;">019</span>             <span style="color: #efdcbc;">$totalcolors</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span>  <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">ImageColorsTotal</span>(<span style="color: #efdcbc;">$gd_image</span>);<br /> <span style="color: #f810b0;">020</span>             <span style="color: #efdcbc;">$icXOR</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">&#8221;</span>;<br /> <span style="color: #7f9f7f;">021</span>             <span style="color: #e3ceab;">for</span> (<span style="color: #efdcbc;">$y</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$ImageHeights</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">-</span> <span style="color: #8cd0d3;">1</span>; <span style="color: #efdcbc;">$y</span> <span style="color: #dcdccc;">>=</span> <span style="color: #8cd0d3;"></span>; <span style="color: #efdcbc;">$y</span><span style="color: #dcdccc;">&#8211;</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">022</span>                 <span style="color: #e3ceab;">for</span> (<span style="color: #efdcbc;">$x</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;"></span>; <span style="color: #efdcbc;">$x</span> <span style="color: #dcdccc;"><</span> <span style="color: #efdcbc;">$ImageWidths</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">];</span> <span style="color: #efdcbc;">$x</span><span style="color: #dcdccc;">++</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">023</span>                     <span style="color: #efdcbc;">$argb</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">GetPixelColor</span>(<span style="color: #efdcbc;">$gd_image</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$x</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$y</span>);<br /> <span style="color: #7f9f7f;">024</span>                     <span style="color: #efdcbc;">$a</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">round</span>(<span style="color: #8cd0d3;">255</span> <span style="color: #dcdccc;">*</span> ((<span style="color: #8cd0d3;">127</span> <span style="color: #dcdccc;">-</span> <span style="color: #efdcbc;">$argb</span><span style="color: #dcdccc;">[</span><span style="color: #cc9393;">'alpha'</span><span style="color: #dcdccc;">])</span> <span style="color: #dcdccc;">/</span> <span style="color: #8cd0d3;">127</span>));<br /> <span style="color: #f810b0;">025</span>                     <span style="color: #efdcbc;">$r</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$argb</span><span style="color: #dcdccc;">[</span><span style="color: #cc9393;">'red'</span><span style="color: #dcdccc;">];</span><br /> <span style="color: #7f9f7f;">026</span>                     <span style="color: #efdcbc;">$g</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$argb</span><span style="color: #dcdccc;">[</span><span style="color: #cc9393;">'green'</span><span style="color: #dcdccc;">];</span><br /> <span style="color: #7f9f7f;">027</span>                     <span style="color: #efdcbc;">$b</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$argb</span><span style="color: #dcdccc;">[</span><span style="color: #cc9393;">'blue'</span><span style="color: #dcdccc;">];</span><br /> <span style="color: #7f9f7f;">028</span>                     <span style="color: #e3ceab;">if</span> (<span style="color: #efdcbc;">$bpp</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">==</span> <span style="color: #8cd0d3;">32</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">029</span>                         <span style="color: #efdcbc;">$icXOR</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$b</span>)<span style="color: #dcdccc;">.</span><span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$g</span>)<span style="color: #dcdccc;">.</span><span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$r</span>)<span style="color: #dcdccc;">.</span><span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$a</span>);<br /> <span style="color: #f810b0;">030</span>                     <span style="color: #dcdccc;">}</span> <span style="color: #e3ceab;">elseif</span> (<span style="color: #efdcbc;">$bpp</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">==</span> <span style="color: #8cd0d3;">24</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">031</span>                         <span style="color: #efdcbc;">$icXOR</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$b</span>)<span style="color: #dcdccc;">.</span><span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$g</span>)<span style="color: #dcdccc;">.</span><span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$r</span>);<br /> <span style="color: #7f9f7f;">032</span>                     <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">033</span>                     <span style="color: #e3ceab;">if</span> (<span style="color: #efdcbc;">$a</span> <span style="color: #dcdccc;"><</span> <span style="color: #8cd0d3;">128</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">034</span>                         <span style="color: #dcdccc;">@</span><span style="color: #efdcbc;">$icANDmask</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">][</span><span style="color: #efdcbc;">$y</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8217;1&#8242;</span>;<br /> <span style="color: #f810b0;">035</span>                     <span style="color: #dcdccc;">}</span> <span style="color: #e3ceab;">else</span> <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">036</span>                         <span style="color: #dcdccc;">@</span><span style="color: #efdcbc;">$icANDmask</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">][</span><span style="color: #efdcbc;">$y</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8217;0&#8242;</span>;<br /> <span style="color: #7f9f7f;">037</span>                     <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">038</span>                 <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">039</span>                 <span style="color: #7f9f7f;">// mask bits are 32-bit aligned per scanline </span><br /> <span style="color: #f810b0;">040</span>                 <span style="color: #e3ceab;">while</span> (<span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$icANDmask</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">][</span><span style="color: #efdcbc;">$y</span><span style="color: #dcdccc;">])</span> <span style="color: #dcdccc;">%</span> <span style="color: #8cd0d3;">32</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">041</span>                     <span style="color: #efdcbc;">$icANDmask</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">][</span><span style="color: #efdcbc;">$y</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8217;0&#8242;</span>;<br /> <span style="color: #7f9f7f;">042</span>                 <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">043</span>             <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">044</span>             <span style="color: #efdcbc;">$icAND</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">&#8221;</span>;<br /> <span style="color: #f810b0;">045</span>             <span style="color: #e3ceab;">foreach</span> (<span style="color: #efdcbc;">$icANDmask</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #e3ceab;">as</span> <span style="color: #efdcbc;">$y</span> <span style="color: #dcdccc;">=></span> <span style="color: #efdcbc;">$scanlinemaskbits</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">046</span>                 <span style="color: #e3ceab;">for</span> (<span style="color: #efdcbc;">$i</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;"></span>; <span style="color: #efdcbc;">$i</span> <span style="color: #dcdccc;"><</span> <span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$scanlinemaskbits</span>); <span style="color: #efdcbc;">$i</span> <span style="color: #dcdccc;">+=</span> <span style="color: #8cd0d3;">8</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">047</span>                     <span style="color: #efdcbc;">$icAND</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #f0dfaf; font-weight: bold;">bindec</span>(<span style="color: #f0dfaf; font-weight: bold;">str_pad</span>(<span style="color: #f0dfaf; font-weight: bold;">substr</span>(<span style="color: #efdcbc;">$scanlinemaskbits</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$i</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">8</span><span style="color: #dcdccc;">),</span> <span style="color: #8cd0d3;">8</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">&#8217;0&#8242;</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">STR_PAD_LEFT</span>)));<br /> <span style="color: #7f9f7f;">048</span>                 <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">049</span>             <span style="color: #dcdccc;">}</span><br /> <span style="color: #f810b0;">050</span>         <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">051</span>         <span style="color: #e3ceab;">foreach</span> (<span style="color: #efdcbc;">$gd_image_array</span> <span style="color: #e3ceab;">as</span> <span style="color: #efdcbc;">$key</span> <span style="color: #dcdccc;">=></span> <span style="color: #efdcbc;">$gd_image</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">052</span>             <span style="color: #efdcbc;">$biSizeImage</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$ImageWidths</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">*</span> <span style="color: #efdcbc;">$ImageHeights</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">*</span> (<span style="color: #efdcbc;">$bpp</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">/</span> <span style="color: #8cd0d3;">8</span>);<br /> <span style="color: #7f9f7f;">053</span>             <span style="color: #7f9f7f;">// BITMAPINFOHEADER &#8211; 40 bytes </span><br /> <span style="color: #7f9f7f;">054</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span>  <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">&#8221;</span>;<br /> <span style="color: #f810b0;">055</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x28\x00\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                              <span style="color: #7f9f7f;">// DWORD  biSize; </span><br /> <span style="color: #7f9f7f;">056</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #efdcbc;">$ImageWidths</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">],</span> <span style="color: #8cd0d3;">4</span>);      <span style="color: #7f9f7f;">// LONG   biWidth; </span><br /> <span style="color: #7f9f7f;">057</span>             <span style="color: #7f9f7f;">// The biHeight member specifies the combined </span><br /> <span style="color: #7f9f7f;">058</span>             <span style="color: #7f9f7f;">// height of the XOR and AND masks. </span><br /> <span style="color: #7f9f7f;">059</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #efdcbc;">$ImageHeights</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">*</span> <span style="color: #8cd0d3;">2</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">4</span>); <span style="color: #7f9f7f;">// LONG   biHeight; </span><br /> <span style="color: #f810b0;">060</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x01\x00</span><span style="color: #cc9393;">&#8220;</span>;                                      <span style="color: #7f9f7f;">// WORD   biPlanes; </span><br /> <span style="color: #7f9f7f;">061</span>                <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$bpp</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">])</span><span style="color: #dcdccc;">.</span><span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00</span><span style="color: #cc9393;">&#8220;</span>;                          <span style="color: #7f9f7f;">// wBitCount; </span><br /> <span style="color: #7f9f7f;">062</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00\x00\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                              <span style="color: #7f9f7f;">// DWORD  biCompression; </span><br /> <span style="color: #7f9f7f;">063</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #efdcbc;">$biSizeImage</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">4</span>);            <span style="color: #7f9f7f;">// DWORD  biSizeImage; </span><br /> <span style="color: #7f9f7f;">064</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00\x00\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                              <span style="color: #7f9f7f;">// LONG   biXPelsPerMeter; </span><br /> <span style="color: #f810b0;">065</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00\x00\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                              <span style="color: #7f9f7f;">// LONG   biYPelsPerMeter; </span><br /> <span style="color: #7f9f7f;">066</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00\x00\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                              <span style="color: #7f9f7f;">// DWORD  biClrUsed; </span><br /> <span style="color: #7f9f7f;">067</span>             <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00\x00\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                              <span style="color: #7f9f7f;">// DWORD  biClrImportant; </span><br /> <span style="color: #7f9f7f;">068</span>         <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">069</span>         <span style="color: #efdcbc;">$icondata</span>  <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00\x00</span><span style="color: #cc9393;">&#8220;</span>;                                      <span style="color: #7f9f7f;">// idReserved;   // Reserved (must be 0) </span><br /> <span style="color: #f810b0;">070</span>         <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x01\x00</span><span style="color: #cc9393;">&#8220;</span>;                                      <span style="color: #7f9f7f;">// idType;       // Resource Type (1 for icons) </span><br /> <span style="color: #7f9f7f;">071</span>         <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #f0dfaf; font-weight: bold;">count</span>(<span style="color: #efdcbc;">$gd_image_array</span><span style="color: #dcdccc;">),</span> <span style="color: #8cd0d3;">2</span>);  <span style="color: #7f9f7f;">// idCount;      // How many images? </span><br /> <span style="color: #7f9f7f;">072</span>         <span style="color: #efdcbc;">$dwImageOffset</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;">6</span> <span style="color: #dcdccc;">+</span> (<span style="color: #f0dfaf; font-weight: bold;">count</span>(<span style="color: #efdcbc;">$gd_image_array</span>) <span style="color: #dcdccc;">*</span> <span style="color: #8cd0d3;">16</span>);<br /> <span style="color: #7f9f7f;">073</span>         <span style="color: #e3ceab;">foreach</span> (<span style="color: #efdcbc;">$gd_image_array</span> <span style="color: #e3ceab;">as</span> <span style="color: #efdcbc;">$key</span> <span style="color: #dcdccc;">=></span> <span style="color: #efdcbc;">$gd_image</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">074</span>             <span style="color: #7f9f7f;">// ICONDIRENTRY   idEntries[1]; // An entry for each image (idCount of &#8216;em) </span><br /> <span style="color: #f810b0;">075</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$ImageWidths</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span>                     <span style="color: #7f9f7f;">// bWidth;          // Width, in pixels, of the image </span><br /> <span style="color: #7f9f7f;">076</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$ImageHeights</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span>                    <span style="color: #7f9f7f;">// bHeight;         // Height, in pixels, of the image </span><br /> <span style="color: #7f9f7f;">077</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$totalcolors</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span>                     <span style="color: #7f9f7f;">// bColorCount;     // Number of colors in image (0 if >=8bpp) </span><br /> <span style="color: #7f9f7f;">078</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00</span><span style="color: #cc9393;">&#8220;</span>;                                      <span style="color: #7f9f7f;">// bReserved;       // Reserved ( must be 0) </span><br /> <span style="color: #7f9f7f;">079</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x01\x00</span><span style="color: #cc9393;">&#8220;</span>;                                  <span style="color: #7f9f7f;">// wPlanes;         // Color Planes </span><br /> <span style="color: #f810b0;">080</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$bpp</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">])</span><span style="color: #dcdccc;">.</span><span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00</span><span style="color: #cc9393;">&#8220;</span>;                      <span style="color: #7f9f7f;">// wBitCount;       // Bits per pixel </span><br /> <span style="color: #7f9f7f;">081</span>             <span style="color: #efdcbc;">$dwBytesInRes</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;">40</span> <span style="color: #dcdccc;">+</span> <span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$icXOR</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">])</span> <span style="color: #dcdccc;">+</span> <span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$icAND</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span><br /> <span style="color: #7f9f7f;">082</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #efdcbc;">$dwBytesInRes</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">4</span>);       <span style="color: #7f9f7f;">// dwBytesInRes;    // How many bytes in this resource? </span><br /> <span style="color: #7f9f7f;">083</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$this</span><span style="color: #dcdccc;">-></span><span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #efdcbc;">$dwImageOffset</span><span style="color: #dcdccc;">,</span> <span style="color: #8cd0d3;">4</span>);      <span style="color: #7f9f7f;">// dwImageOffset;   // Where in the file is this image? </span><br /> <span style="color: #7f9f7f;">084</span>             <span style="color: #efdcbc;">$dwImageOffset</span> <span style="color: #dcdccc;">+=</span> <span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span><br /> <span style="color: #f810b0;">085</span>             <span style="color: #efdcbc;">$dwImageOffset</span> <span style="color: #dcdccc;">+=</span> <span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$icXOR</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span><br /> <span style="color: #7f9f7f;">086</span>             <span style="color: #efdcbc;">$dwImageOffset</span> <span style="color: #dcdccc;">+=</span> <span style="color: #f0dfaf; font-weight: bold;">strlen</span>(<span style="color: #efdcbc;">$icAND</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">]);</span><br /> <span style="color: #7f9f7f;">087</span>         <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">088</span>         <span style="color: #e3ceab;">foreach</span> (<span style="color: #efdcbc;">$gd_image_array</span> <span style="color: #e3ceab;">as</span> <span style="color: #efdcbc;">$key</span> <span style="color: #dcdccc;">=></span> <span style="color: #efdcbc;">$gd_image</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">089</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$BitmapInfoHeader</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">];</span><br /> <span style="color: #f810b0;">090</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$icXOR</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">];</span><br /> <span style="color: #7f9f7f;">091</span>             <span style="color: #efdcbc;">$icondata</span> <span style="color: #dcdccc;">.=</span> <span style="color: #efdcbc;">$icAND</span><span style="color: #dcdccc;">[</span><span style="color: #efdcbc;">$key</span><span style="color: #dcdccc;">];</span><br /> <span style="color: #7f9f7f;">092</span>         <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">093</span>         <span style="color: #e3ceab;">return</span> <span style="color: #efdcbc;">$icondata</span>;<br /> <span style="color: #7f9f7f;">094</span>     <span style="color: #dcdccc;">}</span><br /> <span style="color: #f810b0;">095</span>     <span style="color: #e3ceab;">function</span> <span style="color: #efef8f;">LittleEndian2String</span>(<span style="color: #efdcbc;">$number</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$minbytes</span><span style="color: #dcdccc;">=</span><span style="color: #8cd0d3;">1</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">096</span>         <span style="color: #efdcbc;">$intstring</span> <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">&#8221;</span>;<br /> <span style="color: #7f9f7f;">097</span>         <span style="color: #e3ceab;">while</span> (<span style="color: #efdcbc;">$number</span> <span style="color: #dcdccc;">></span> <span style="color: #8cd0d3;"></span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">098</span>             <span style="color: #efdcbc;">$intstring</span> <span style="color: #dcdccc;">=</span> <span style="color: #efdcbc;">$intstring</span><span style="color: #dcdccc;">.</span><span style="color: #f0dfaf; font-weight: bold;">chr</span>(<span style="color: #efdcbc;">$number</span> <span style="color: #dcdccc;">&</span> <span style="color: #8cd0d3;">255</span>);<br /> <span style="color: #7f9f7f;">099</span>             <span style="color: #efdcbc;">$number</span> <span style="color: #dcdccc;">>>=</span> <span style="color: #8cd0d3;">8</span>;<br /> <span style="color: #f810b0;">100</span>         <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">101</span>         <span style="color: #e3ceab;">return</span> <span style="color: #f0dfaf; font-weight: bold;">str_pad</span>(<span style="color: #efdcbc;">$intstring</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$minbytes</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">&#8220;</span><span style="color: #cc9393;">\x00</span><span style="color: #cc9393;">&#8220;</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">STR_PAD_RIGHT</span>);<br /> <span style="color: #7f9f7f;">102</span>     <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">103</span>     <span style="color: #e3ceab;">function</span> <span style="color: #efef8f;">GetPixelColor</span>(<span style="color: #dcdccc;">&</span><span style="color: #efdcbc;">$img</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$x</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$y</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #7f9f7f;">104</span>         <span style="color: #e3ceab;">if</span> (<span style="color: #dcdccc;">!</span><span style="color: #f0dfaf; font-weight: bold;">is_resource</span>(<span style="color: #efdcbc;">$img</span>)) <span style="color: #dcdccc;">{</span><br /> <span style="color: #f810b0;">105</span>             <span style="color: #e3ceab;">return</span> <span style="color: #e3ceab;">false</span>;<br /> <span style="color: #7f9f7f;">106</span>         <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">107</span>         <span style="color: #e3ceab;">return</span> <span style="color: #dcdccc;">@</span><span style="color: #dcdccc;">ImageColorsForIndex</span>(<span style="color: #efdcbc;">$img</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">@</span><span style="color: #dcdccc;">ImageColorAt</span>(<span style="color: #efdcbc;">$img</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$x</span><span style="color: #dcdccc;">,</span> <span style="color: #efdcbc;">$y</span>));<br /> <span style="color: #7f9f7f;">108</span>     <span style="color: #dcdccc;">}</span><br /> <span style="color: #7f9f7f;">109</span> <span style="color: #dcdccc;">}</span><br /> <span style="color: #f810b0;">110</span> <span style="color: #ffcfaf; font-weight: bold;">?></span>
</div>

转载请注明：[于哲的博客][2] &raquo; [Lazy Icon—在线Icon转换][3]

 [1]: http://lazynight.me/wp-content/uploads/2012/03/icon.gif
 [2]: http://localhost/wordpress
 [3]: http://localhost/wordpress/1534.html